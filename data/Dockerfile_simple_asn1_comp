# Use a base image with GCC and Python pre-installed
FROM ubuntu:22.04

# Install dependencies
RUN apt-get update && apt-get install -y \
    wget \
    tar \
    build-essential \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Download and install the Data Modelling Tools (DMT)
WORKDIR /opt
RUN wget https://download.tuxfamily.org/taste/DMT/DMT-latest.tgz && \
    tar zxvf DMT-latest.tgz && \
    rm DMT-latest.tgz

# Set up DMT environment variables
ENV DMT_HOME /opt/DMT
ENV PATH="${DMT_HOME}/tools/asn1scc.3:${PATH}"

# Install Python dependencies
RUN pip3 install asn1tools

# Copy your project files into the container
WORKDIR /workspace
COPY . .

# Compile ASN.1 schemas and run tests
RUN asn1.exe -c -uPER data/sensor_data.asn && \
    gcc -c -I . *.c && \
    echo "ASN.1 compilation and C code generation completed successfully."

# Set the default command to run your tests
CMD ["python3", "scripts/run_tests.py"]
